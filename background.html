<!--
   - For https://chrome.google.com/webstore/detail/mgmiemnjjchgkmgbeljfocdjjnpjnmcg
   -->

<!-- <script type="text/javascript" src="jquery.js"></script> -->
<script type="text/javascript" src="xml2array.js"></script>
<script type="text/javascript">
// Learn more about poke v2 here:
// https://github.com/michaelhart/Awesome-New-Tab-Page/wiki/Poke-v2
var info = {
  "poke"    :   2,              // poke version 2
  "width"   :   2,              // 406 px default
  "height"  :   1,              // 200 px default
  "path"    :   "widget.html",
  "v2"      :   {
                  "resize"    :   true,  // Set to true ONLY if you create a range below.
                  "min_width" :   1,
                  "max_width" :   2,
                  "min_height":   1,
                  "max_height":   1
                }
};

chrome.extension.onRequestExternal.addListener(function(request, sender, sendResponse) {
  if(request === "mgmiemnjjchgkmgbeljfocdjjnpjnmcg-poke") {
    chrome.extension.sendRequest(
      sender.id,
      {
        head: "mgmiemnjjchgkmgbeljfocdjjnpjnmcg-pokeback",
        body: info,
      }
    );
  }
});

function update() {
  var place = localStorage.getItem("place") || "San Francisco, CA";
  var hl = localStorage.getItem("hl") || "en";

  var url = "https://www.google.com/ig/api?weather=" + place + "&hl=" + hl;
  var xml = new JKL.ParseXML( url );
  var data = xml.parse();

  if ( data.xml_api_reply
    && typeof(data.xml_api_reply) === "object" ) {
    localStorage.setItem("weather", JSON.stringify( data ));
  }
}

setInterval(update, 15*60*1000);
update();


</script>